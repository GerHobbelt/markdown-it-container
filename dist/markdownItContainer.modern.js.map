{"version":3,"file":"markdownItContainer.modern.js","sources":["../index.js"],"sourcesContent":["// Process block-level custom containers\n//\n\nmodule.exports = function container_plugin(md, name, options) {\n\n  // Second param may be useful if you decide\n  // to increase minimal allowed marker length\n  function validateDefault(params/*, markup*/) {\n    return params.trim().split(' ', 2)[0] === name;\n  }\n\n  function renderDefault(tokens, idx, _options, env, slf) {\n\n    // add a class to the opening tag\n    if (tokens[idx].nesting === 1) {\n      tokens[idx].attrJoin('class', name);\n    }\n\n    return slf.renderToken(tokens, idx, _options, env, slf);\n  }\n\n  options = options || {};\n\n  let min_markers = options.minMarkerCount || 3,\n      marker_str  = options.marker || ':',\n      end_marker_str  = options.endMarker || marker_str,\n      end_marker_len = end_marker_str.length,\n      marker_char = marker_str.charCodeAt(0),\n      marker_len  = marker_str.length,\n      validate    = options.validate || validateDefault,\n      render      = options.render || renderDefault,\n      customContent = !!options.content;\n\n  function container(state, startLine, endLine, silent) {\n    let pos, nextLine, marker_count, markup, params, token,\n        old_parent, old_line_max,\n        blockStart,\n        auto_closed = false,\n        start = blockStart = state.bMarks[startLine] + state.tShift[startLine],\n        max = state.eMarks[startLine];\n\n    // Check out the first character quickly,\n    // this should filter out most of non-containers\n    //\n    if (marker_char !== state.src.charCodeAt(start)) { return false; }\n\n    // Check out the rest of the marker string\n    //\n    for (pos = start + 1; pos <= max; pos++) {\n      if (marker_str[(pos - start) % marker_len] !== state.src[pos]) {\n        break;\n      }\n    }\n\n    marker_count = Math.floor((pos - start) / marker_len);\n    if (marker_count < min_markers) { return false; }\n    pos -= (pos - start) % marker_len;\n\n    markup = state.src.slice(start, pos);\n    params = state.src.slice(pos, max);\n    if (!validate(params, markup)) { return false; }\n\n    // Since start is found, we can report success here in validation mode\n    //\n    if (silent) { return true; }\n\n    let contentStart = max;\n\n    // Search for the end of the block\n    //\n    nextLine = startLine;\n\n    for (;;) {\n      nextLine++;\n      if (nextLine >= endLine) {\n        // unclosed block should be autoclosed by end of document.\n        // also block seems to be autoclosed by end of parent\n        break;\n      }\n\n      start = state.bMarks[nextLine] + state.tShift[nextLine];\n      max = state.eMarks[nextLine];\n\n      if (start < max && state.sCount[nextLine] < state.blkIndent) {\n        // non-empty line with negative indent should stop the list:\n        // - ```\n        //  test\n        break;\n      }\n\n      if (marker_char !== state.src.charCodeAt(start)) { continue; }\n\n      if (state.sCount[nextLine] - state.blkIndent >= 4) {\n        // closing fence should be indented less than 4 spaces\n        continue;\n      }\n\n      for (pos = start + 1; pos <= max; pos++) {\n        if (end_marker_str[(pos - start) % end_marker_len] !== state.src[pos]) {\n          break;\n        }\n      }\n\n      // closing code fence must be at least as long as the opening one\n      if (Math.floor((pos - start) / end_marker_len) < marker_count) { continue; }\n\n      // make sure tail has spaces only\n      pos -= (pos - start) % end_marker_len;\n      pos = state.skipSpaces(pos);\n\n      if (pos < max) { continue; }\n\n      // found!\n      auto_closed = true;\n      break;\n    }\n\n    old_parent = state.parentType;\n    old_line_max = state.lineMax;\n    state.parentType = 'container';\n\n    // this will prevent lazy continuations from ever going past our end marker\n    state.lineMax = nextLine;\n\n    token        = state.push('container_' + name + '_open', 'div', 1);\n    token.markup = markup;\n    token.block  = true;\n    token.info   = params;\n    token.map    = [ startLine, nextLine ];\n    token.position = blockStart;\n    token.size = state.eMarks[nextLine] - blockStart;\n\n    if (customContent) {\n      token = state.push('container_' + name + '_content', 'div', 0);\n      token.markup = state.src.slice(contentStart, start);\n      token.block = true;\n      token.position = contentStart;\n      token.size = token.markup.length;\n    } else {\n      state.md.block.tokenize(state, startLine + 1, nextLine);\n    }\n\n    token        = state.push('container_' + name + '_close', 'div', -1);\n    token.markup = state.src.slice(start, pos);\n    token.block  = true;\n    token.position = pos;\n    token.size = 0;\n\n    state.parentType = old_parent;\n    state.lineMax = old_line_max;\n    state.line = nextLine + (auto_closed ? 1 : 0);\n\n    return true;\n  }\n\n  md.block.ruler.before('fence', 'container_' + name, container, {\n    alt: [ 'paragraph', 'reference', 'blockquote', 'list' ]\n  });\n  md.renderer.rules['container_' + name + '_open'] = render;\n  if (customContent) {\n    md.renderer.rules['container_' + name + '_content'] = options.content;\n  }\n  md.renderer.rules['container_' + name + '_close'] = render;\n};\n"],"names":["module","exports","container_plugin","md","name","options","validateDefault","params","trim","split","renderDefault","tokens","idx","_options","env","slf","nesting","attrJoin","renderToken","min_markers","minMarkerCount","marker_str","marker","end_marker_str","endMarker","end_marker_len","length","marker_char","charCodeAt","marker_len","validate","render","customContent","content","container","state","startLine","endLine","silent","pos","nextLine","marker_count","markup","token","old_parent","old_line_max","blockStart","auto_closed","start","bMarks","tShift","max","eMarks","src","Math","floor","slice","contentStart","sCount","blkIndent","skipSpaces","parentType","lineMax","push","block","info","map","position","size","tokenize","line","ruler","before","alt","renderer","rules"],"mappings":"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"}